services:
  # FRONT
  frontend:
    build: ./frontend
    env_file:
      - .env
    container_name: frontend
    ports:
      - "${FRONTEND_PORT}:${FRONTEND_PORT}"
    depends_on:
      - user
      - game
      - game2
    networks:
      - app-network
    volumes:
      - frontend_db_data:/data
      - ./frontend/src:/app/src:cached
      - ./frontend/package.json:/app/package.json:cached
      - ./frontend/tsconfig.json:/app/tsconfig.json:cached
  
  # NGINX
  nginx:
    build: ./nginx
    env_file:
      - .env
    container_name: nginx
    restart: always
    ports:
      - "8443:${NGINX_HTTPS_PORT}"
    depends_on:
      - frontend
    networks:
      - app-network
    volumes:
      - ./nginx/nginx.conf.template:/etc/nginx/nginx.conf.template:ro

  # Microservices
  user:
    build: ./microservices/usermanagement
    env_file:
      - .env
    container_name: user-service
    volumes:
      - user_db_data:/data
      # ⚡ FOR DEV FILE IN SRC NEED TO BE WATCH MODIF
      - ./microservices/usermanagement/src:/app/src:cached
      - ./microservices/usermanagement/package.json:/app/package.json:cached
      - ./microservices/usermanagement/tsconfig.json:/app/tsconfig.json:cached
    ports:
      - "${USER_MANA_PORT}:${USER_MANA_PORT}"
    networks:
      - app-network

  game:
    build: ./microservices/game
    env_file:
      - .env
    container_name: game-service
    volumes:
      - game_db_data:/data
      # ⚡ FOR DEV FILE IN SRC NEED TO BE WATCH MODIF
      - ./microservices/game/src:/app/src:cached
      - ./microservices/game/package.json:/app/package.json:cached
      - ./microservices/game/tsconfig.json:/app/tsconfig.json:cached
    ports:
      - "${GAME_PORT}:${GAME_PORT}"
    networks:
      - app-network

  game2:
    build: ./microservices/game2
    env_file:
      - .env
    container_name: game2-service
    volumes:
      - game2_db_data:/data
      # ⚡ FOR DEV FILE IN SRC NEED TO BE WATCH MODIF
      - ./microservices/game2/src:/app/src:cached
      - ./microservices/game2/package.json:/app/package.json:cached
      - ./microservices/game2/tsconfig.json:/app/tsconfig.json:cached
    ports:
      - "${GAME2_PORT}:${GAME2_PORT}"
    networks:
      - app-network

# Volumes
volumes:
  frontend_db_data:
  user_db_data:
  game_db_data:
  game2_db_data:

# Networks
networks:
  app-network:
    driver: bridge
